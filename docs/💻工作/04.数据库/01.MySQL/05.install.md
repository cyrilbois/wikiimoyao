---
title: 使用清华源安装 MySQL
date: 2020-12-25 12:55:13
permalink: /mysql/install/
categories:
  - 💻工作
  - 数据库
  - MySQL
tags:
  - MySQL
---

## Yum 安装
1.  卸载之前的 MySQL（如果有的话）
```bash    
pkill -9 mysqld  # 停止MySQL
rpm -qa | grep -i mysql # 列出现有的MySQL安装包
yum -y remove 包名 # 使用这个命令删除列出来的包名
rpm -ev  包名 # 如果yum删除不了,就用这个命令删
```
2.  下载 MySQL 源
```bash  
wget http://repo.mysql.com/mysql57-community-release-el7-8.noarch.rpm 
rpm -ivh mysql57-community-release-el7-8.noarch.rpm 
```
3.  替换清华源
根据这个地址 `https://mirror.tuna.tsinghua.edu.cn/help/centos/` 设置清华大学的源，注意把 `gpgcheck=1` 改为 `gpgcheck=0` ， 否则安装会失败
```plain
# CentOS-Base.repo
#
# The mirror system uses the connecting IP address of the client and the
# update status of each mirror to pick mirrors that are updated to and
# geographically close to the client.  You should use this for CentOS updates
# unless you are manually picking other mirrors.
#
# If the mirrorlist= does not work for you, as a fall back you can try the
# remarked out baseurl= line instead.
#
#


[base]
name=CentOS-$releasever - Base
baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos/$releasever/os/$basearch/
#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=os
enabled=1
gpgcheck=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-7

#released updates
[updates]
name=CentOS-$releasever - Updates
baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos/$releasever/updates/$basearch/
#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=updates
enabled=1
gpgcheck=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-7



#additional packages that may be useful
[extras]
name=CentOS-$releasever - Extras
baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos/$releasever/extras/$basearch/
#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=extras
enabled=1
gpgcheck=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-7


#additional packages that extend functionality of existing packages
[centosplus]
name=CentOS-$releasever - Plus
baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos/$releasever/centosplus/$basearch/
#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=centosplus
gpgcheck=0
enabled=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-7

```
4. 执行安装
```bash
yum -y install mysql-server 
```
5. 启动服务
```bash
systemctl enable mysqld
systemctl start mysqld
```
::: error
如果启动服务报错，
1. 如果是 SELinux 问题，请参阅[解决 Linux-Centos7 启动 Mysql 服务失败_编程渣-王爽-CSDN 博客](https://blog.csdn.net/wsh_0703/article/details/80278370)
2. `datadir`不对
```plain
2020-12-25T05:54:16.053547Z 0 [Warning] Failed to open optimizer cost constant tables

2020-12-25T05:54:16.053696Z 0 [ERROR] Fatal error: Can't open and lock privilege tables: Table 'mysql.user' doesn't exist
2020-12-25T05:54:16.053715Z 0 [ERROR] Fatal error: Failed to initialize ACL/grant/time zones structures or failed to remove temporary table files.
2020-12-25T05:54:16.053760Z 0 [ERROR] Aborting

```
修改`/etc/my.conf`中的`datadir=/var/lib/mysql/mysql`，根据实际修改
参阅：[Can't open and lock privilege tables: Table 'mysql.user' doesn't exist - Stack Overflow](https://stackoverflow.com/questions/34516664/cant-open-and-lock-privilege-tables-table-mysql-user-doesnt-exist)
:::
6. 以原始密码登录
```bash
grep 'password' /var/log/mysqld.log # 从这里拿到初始化的密码
mysql -uroot -p # 登录
```
7. 修改密码安全策略
在测试环境使用，密码可以弄简单点，生产建议需要设置复杂
```bash
set global validate_password_length=0; # 密码最小长度策略
set global validate_password_policy=0; # 密码强度检查等级策略，0/LOW、1/MEDIUM、2/STRONG
set password for 'root'@'localhost' = password('123456');   # 密码修改为真实实际密码
```
参考配置：
```plain
[mysqld]
#
# Remove leading # and set to the amount of RAM for the most important data
# cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.
# innodb_buffer_pool_size = 128M
#
# Remove leading # to turn on a very important data integrity option: logging
# changes to the binary log between backups.
# log_bin
#
# Remove leading # to set options mainly useful for reporting servers.
# The server defaults are faster for transactions and fast SELECTs.
# Adjust sizes as needed, experiment to find the optimal values.
# join_buffer_size = 128M
# sort_buffer_size = 2M
# read_rnd_buffer_size = 2M
datadir=/var/lib/mysql/mysql
socket=/var/lib/mysql/mysql.sock

# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links=0

log-error=/var/log/mysqld.log
pid-file=/var/run/mysqld/mysqld.pid
# 编码
character_set_server=utf8 
init_connect='SET NAMES utf8'
```
8. 开启 mysql 远程连接（可选）
```bash
GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY '123456' WITH GRANT OPTION;
flush privileges;
```
9. 放开服务器端口权限（如果选择上步）
```bash
firewall-cmd --zone=public --add-port=3306/tcp --permanent
firewall-cmd --reload
```
## 参考链接
- [CentOS 安装 MySQL 详解](https://juejin.cn/post/6844903870053761037)
- [CentOS7 下安装 mysql5.7_不甘于平凡的溃败的博客-CSDN 博客_centos7 安装 mysql5.7](https://blog.csdn.net/wohiusdashi/article/details/89358071)